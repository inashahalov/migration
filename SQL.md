
---

### 1. **CTE (–æ—Å–æ–±–µ–Ω–Ω–æ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ) ‚Äî –¥–ª—è –∏–µ—Ä–∞—Ä—Ö–∏–π**
**–ó–∞—á–µ–º —Ç–µ–±–µ:**  
–¢—ã —á–∞—Å—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—à—å —Å –º–æ–Ω–æ–ª–∏—Ç–∞–º–∏ –∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞–º–∏ ‚Äî —Ç–∞–º –ø–æ–≤—Å—é–¥—É –∏–µ—Ä–∞—Ä—Ö–∏–∏: –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤, –¥–µ—Ä–µ–≤—å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π. –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π CTE ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —á–∏—Å—Ç—ã–π —Å–ø–æ—Å–æ–± –æ–±–æ–π—Ç–∏ —Ç–∞–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ SQL –±–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–æ–¥–∞.

**–ö–∞–∫ —É—á–∏—Ç—å:**
- –ù–∞—á–Ω–∏ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ: `WITH cte AS (...) SELECT * FROM cte`
- –ó–∞—Ç–µ–º ‚Äî —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —à–∞–±–ª–æ–Ω:
  ```sql
  WITH RECURSIVE tree AS (
    -- —è–∫–æ—Ä—å (root)
    SELECT id, parent_id, name, 0 AS level
    FROM departments
    WHERE parent_id IS NULL

    UNION ALL

    -- —Ä–µ–∫—É—Ä—Å–∏—è
    SELECT d.id, d.parent_id, d.name, t.level + 1
    FROM departments d
    JOIN tree t ON d.parent_id = t.id
  )
  SELECT * FROM tree;
  ```

**–ì–¥–µ –ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å:**
- **PostgreSQL + Northwind –∏–ª–∏ Sakila** ‚Äî –∑–∞–≥—Ä—É–∑–∏ –∏—Ö –ª–æ–∫–∞–ª—å–Ω–æ (—Ç—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å Northwind). –î–æ–±–∞–≤—å –≤ –ª—é–±—É—é —Ç–∞–±–ª–∏—Ü—É –∫–æ–ª–æ–Ω–∫—É `parent_id` –∏ –ø–æ—Å—Ç—Ä–æ–π –∏–µ—Ä–∞—Ä—Ö–∏—é.
- **LeetCode**: –∑–∞–¥–∞—á–∏ —Ç–∏–ø–∞ [‚ÄúManager-Employee Hierarchy‚Äù](https://leetcode.com/problems/second-degree-follower/) –∏–ª–∏ [‚ÄúGet Highest Answer Rate Question‚Äù] ‚Äî –Ω–æ –ª—É—á—à–µ –∏—â–∏ –ø–æ —Ç–µ–≥—É **"tree"** –∏–ª–∏ **"hierarchy"**.
- **HackerRank**: —Ä–∞–∑–¥–µ–ª *‚ÄúAdvanced Select‚Äù ‚Üí ‚ÄúBinary Tree Nodes‚Äù*, *‚ÄúNew Companies‚Äù*.
- **–°–æ–∑–¥–∞–π —Å–≤–æ–π –º–∏–Ω–∏-–ø—Ä–æ–µ–∫—Ç**: –≤–æ–∑—å–º–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±–∞–Ω–∫–∞ (–º–æ–∂–Ω–æ –∞–Ω–æ–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å) –∏ –Ω–∞–ø–∏—à–∏ –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç—Ä–æ–∏—Ç –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –æ—Ç –¥–æ—á–µ—Ä–Ω–µ–π –∫–æ–º–ø–∞–Ω–∏–∏ –¥–æ —Ö–æ–ª–¥–∏–Ω–≥–∞.

> üí° **–°–æ–≤–µ—Ç –ø–æ–¥ –†–°**: –ù–µ –ø—ã—Ç–∞–π—Å—è –≤—ã—É—á–∏—Ç—å –≤—Å—ë —Å—Ä–∞–∑—É. –í—ã–¥–µ–ª–∏ **20 –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å**, —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–∏–Ω —Ç–∏–ø –∑–∞–¥–∞—á. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ ‚Äî –æ–±—ã—á–Ω—ã–µ CTE, –≤—Ç–æ—Ä–Ω–∏–∫ ‚Äî —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ. –§–∏–∫—Å–∏—Ä—É–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∑–∞–º–µ—Ç–∫–µ: ¬´–°–µ–≥–æ–¥–Ω—è —Å–¥–µ–ª–∞–ª –¥–µ—Ä–µ–≤–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–π ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç¬ª.

---

### 2. **–û–∫–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: ROW_NUMBER(), RANK(), LAG/LEAD**
**–ó–∞—á–µ–º —Ç–µ–±–µ:**  
–¢—ã –≥–æ–≤–æ—Ä–∏–ª –ø—Ä–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–æ/–ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏, –∏–ª–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤. `LAG/LEAD` –ø–æ–∫–∞–∂—É—Ç, —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å. `ROW_NUMBER()` –ø–æ–º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é –∑–∞–ø–∏—Å–∏ (–∞–∫—Ç—É–∞–ª—å–Ω—É—é).

**–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã:**
```sql
-- –ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è –ø–æ –∫–∞–∂–¥–æ–º—É –∫–ª–∏–µ–Ω—Ç—É
SELECT *
FROM (
  SELECT *,
         ROW_NUMBER() OVER (PARTITION BY client_id ORDER BY version DESC) AS rn
  FROM client_history
) t
WHERE rn = 1;

-- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏
SELECT client_id,
       balance,
       LAG(balance) OVER (PARTITION BY client_id ORDER BY version) AS prev_balance,
       balance - LAG(balance) OVER (PARTITION BY client_id ORDER BY version) AS delta
FROM account_versions;
```

**–ì–¥–µ –ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å:**
- **LeetCode**: –∑–∞–¥–∞—á–∏ —Å —Ç–µ–≥–æ–º *‚Äúwindow function‚Äù* ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, [‚ÄúDepartment Top Three Salaries‚Äù](https://leetcode.com/problems/department-top-three-salaries/), [‚ÄúConsecutive Numbers‚Äù](https://leetcode.com/problems/consecutive-numbers/).
- **SQLZoo** ‚Äî –æ—Ç–ª–∏—á–Ω—ã–π –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç—É—Ç–æ—Ä–∏–∞–ª –ø–æ –æ–∫–æ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º: https://sqlzoo.net/wiki/Window_functions
- **–°–æ–∑–¥–∞–π —Å–≤–æ–π –¥–∞—Ç–∞—Å–µ—Ç**: —Å–¥–µ–ª–∞–π —Ç–∞–±–ª–∏—Ü—É `product_price_history (product_id, price, effective_date)` –∏ –Ω–∞–ø–∏—à–∏ –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–æ–≥–¥–∞ —Ü–µ–Ω–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å –∏ –Ω–∞ —Å–∫–æ–ª—å–∫–æ.

> üí° **–î–ª—è –≤–∏–∑—É–∞–ª–∞**: –Ω–∞—Ä–∏—Å—É–π —Ç–∞–±–ª–∏—Ü—É –Ω–∞ –±—É–º–∞–≥–µ –∏–ª–∏ –≤ draw.io ‚Äî –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è (`PARTITION BY`) –∏ –∫–∞–∫ –æ–∫–Ω–æ –¥–≤–∏–∂–µ—Ç—Å—è (`ORDER BY`). –≠—Ç–æ —Å–∏–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ –†–°.

---

### 3. **EXCEPT / INTERSECT ‚Äî –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏**
**–ó–∞—á–µ–º —Ç–µ–±–µ:**  
–≠—Ç–æ —Ç–≤–æ–π **–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ–≤–µ—Ä–∏—è**. –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —Ç—ã –º–æ–∂–µ—à—å —Å—Ä–∞–≤–Ω–∏—Ç—å:
```sql
-- –ß—Ç–æ –ø–æ—Ç–µ—Ä—è–ª–æ—Å—å?
SELECT id, name, amount FROM old_table
EXCEPT
SELECT id, name, amount FROM new_table;

-- –ß—Ç–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é?
SELECT * FROM old_table
INTERSECT
SELECT * FROM new_table;
```
–ï—Å–ª–∏ `EXCEPT` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ ‚Äî –µ—Å—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è. –≠—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –∏ –Ω–∞–¥—ë–∂–Ω–µ–µ, —á–µ–º —Ä—É—á–Ω–æ–π diff.

**–í–∞–∂–Ω–æ:** –ø–æ—Ä—è–¥–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ –∏ —Ç–∏–ø—ã –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å. –ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ–¥–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É (`::TEXT`, `ROUND(amount, 2)` –∏ —Ç.–ø.).

**–ì–¥–µ –ø—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å:**
- **–°–¥–µ–ª–∞–π —Å–≤–æ–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç**: –≤–æ–∑—å–º–∏ Northwind, —Å–æ–∑–¥–∞–π –∫–æ–ø–∏—é —Ç–∞–±–ª–∏—Ü—ã `Products`, –≤–Ω–µ—Å–∏ –ø–∞—Ä—É –∏–∑–º–µ–Ω–µ–Ω–∏–π (—É–¥–∞–ª–∏ —Å—Ç—Ä–æ–∫—É, –ø–æ–º–µ–Ω—è–π —Ü–µ–Ω—É), –∑–∞—Ç–µ–º —Å—Ä–∞–≤–Ω–∏ —á–µ—Ä–µ–∑ `EXCEPT`.
- **Kaggle**: —Å–∫–∞—á–∞–π –¥–≤–∞ CSV-—Ñ–∞–π–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, sales_2024.csv –∏ sales_2025.csv), –∑–∞–≥—Ä—É–∑–∏ –≤ PostgreSQL –∫–∞–∫ —Ç–∞–±–ª–∏—Ü—ã –∏ —Å—Ä–∞–≤–Ω–∏.
- **–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã**: –Ω–∞ LeetCode —Ç–∞–∫–∏—Ö –∑–∞–¥–∞—á –º–∞–ª–æ, –Ω–æ –º–æ–∂–Ω–æ –Ω–∞ **HackerRank** (—Ä–∞–∑–¥–µ–ª *‚ÄúSet Operations‚Äù*).

> ‚ö†Ô∏è **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ**: `EXCEPT` —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ `NULL`. –ï—Å–ª–∏ –≤ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å `NULL`, –æ–Ω –Ω–µ —Ä–∞–≤–µ–Ω –¥—Ä—É–≥–æ–º—É `NULL` ‚Äî —ç—Ç–æ –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –ª–æ–∂–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è. –ò—Å–ø–æ–ª—å–∑—É–π `IS NOT DISTINCT FROM` –≤—Ä—É—á–Ω—É—é, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Ç–æ—á–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ.

---

### –û–±—â–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–¥ —Ç–≤–æ—é —Å–∏—Ç—É–∞—Ü–∏—é:
1. **–ù–µ —É—á–∏—Å—å "–≤ –æ–±—â–µ–º" ‚Äî —Ä–µ—à–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∑–∞–¥–∞—á—É –º–∏–≥—Ä–∞—Ü–∏–∏**. –ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–ú–Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤ —Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ –º–µ—Å—Ç–µ¬ª. –¢–æ–≥–¥–∞ CTE + EXCEPT —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ.
2. **–§–∏–∫—Å–∏—Ä—É–π –≤—Å—ë –≤ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ**: –¥–∞–∂–µ –ø—Ä–æ—Å—Ç–æ–π `.sql`-—Ñ–∞–π–ª —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ ‚Äî —ç—Ç–æ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏. –ù–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏ —Å–∫–∞–∂–µ—à—å: ¬´–Ø —Ç–∞–∫ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–ª –º–∏–≥—Ä–∞—Ü–∏—é ‚Äî –≤–æ—Ç –ø—Ä–∏–º–µ—Ä¬ª.
3. **–ò—Å–ø–æ–ª—å–∑—É–π PostgreSQL –ª–æ–∫–∞–ª—å–Ω–æ** ‚Äî –æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å—ë —ç—Ç–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é. –£ —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å —Å—Ä–µ–¥–∞ ‚Äî –Ω–µ —Ç–µ—Ä—è–π –≤—Ä–µ–º—è –Ω–∞ –æ–±–ª–∞—á–Ω—ã–µ –ø–µ—Å–æ—á–Ω–∏—Ü—ã.
4. **–û–≥—Ä–∞–Ω–∏—á—å –≤—Ä–µ–º—è**: 30‚Äì45 –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å, 3 –¥–Ω—è –≤ –Ω–µ–¥–µ–ª—é ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã –∑–∞–∫—Ä–µ–ø–∏—Ç—å. –õ—É—á—à–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ, —á–µ–º "–≤ –≤—ã—Ö–æ–¥–Ω—ã–µ –ø–æ 5 —á–∞—Å–æ–≤".

---

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å (—Å–ª–µ–¥—É—é—â–∏–µ 24 —á–∞—Å–∞):
1. –û—Ç–∫—Ä–æ–π PostgreSQL —Å Northwind.
2. –°–æ–∑–¥–∞–π —Ç–∞–±–ª–∏—Ü—É `employees_hierarchy` –Ω–∞ –æ—Å–Ω–æ–≤–µ `employees`, –¥–æ–±–∞–≤–∏–≤ `manager_id`.
3. –ù–∞–ø–∏—à–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π CTE, —á—Ç–æ–±—ã –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —Ü–µ–ø–æ—á–∫—É –æ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –¥–æ CEO.
4. –°–æ—Ö—Ä–∞–Ω–∏ —Å–∫—Ä–∏–ø—Ç –∫–∞–∫ `cte_hierarchy_demo.sql` ‚Äî —ç—Ç–æ —Ç–≤–æ–π –ø–µ—Ä–≤—ã–π –∫–∏—Ä–ø–∏—á –≤ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏.

–ï—Å–ª–∏ —Å–¥–µ–ª–∞–µ—à—å ‚Äî –Ω–∞–ø–∏—à–∏, –∏ —è –ø–æ–º–æ–≥—É —É–ª—É—á—à–∏—Ç—å –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —á–µ—Ä–µ–∑ `EXCEPT`.

–¢—ã –Ω–µ —É—á–∏—à—å SQL —Ä–∞–¥–∏ SQL. –¢—ã —É—á–∏—à—å –µ–≥–æ –∫–∞–∫ **–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—è** –≤ —Ö–∞–æ—Å–µ –º–∏–≥—Ä–∞—Ü–∏–π. –≠—Ç–æ —Ç–≤–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–º–º—É–Ω–∏—Ç–µ—Ç.
