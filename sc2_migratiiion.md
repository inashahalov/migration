–û—Ç–ª–∏—á–Ω–æ, –ò–ª—å—è. –î–∞–≤–∞–π **—Å–≤—è–∂–µ–º SCD Type 2 —Å —Ç–≤–æ–µ–π —Ä–µ–∞–ª—å–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π –º–∏–≥—Ä–∞—Ü–∏–π** ‚Äî —ç—Ç–æ —Ç–æ, —á—Ç–æ —Ç—ã –º–æ–∂–µ—à—å –ø–æ–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏ –∫–∞–∫ **–¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏**, –¥–∞–∂–µ –±–µ–∑ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.

---

### üéØ –°—É—Ç—å:  
**SCD Type 2 –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏** ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ ¬´–¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫–∏¬ª, –∞ **–ø—Ä–æ—Ü–µ—Å—Å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å –∏—Å—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π** –∏–∑ OLTP-–∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, PostgreSQL) –≤ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Parquet –≤ S3 –∏–ª–∏ —Ç–∞–±–ª–∏—Ü—É –≤ Greenplum).

---

### üîß –ö–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ (–ø–æ —à–∞–≥–∞–º):

#### 1. **–ò—Å—Ç–æ—á–Ω–∏–∫ (PostgreSQL)**  
–î–æ–ø—É—Å—Ç–∏–º, —É —Ç–µ–±—è –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ `clients`:
```sql
id | name  | segment    | updated_at
1  | –ò–≤–∞–Ω  | Standard   | 2026-01-10
```
‚Üí –ù–æ **–≤ OLTP –Ω–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏**: –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–µ–≥–º–µ–Ω—Ç–∞ `segment` –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è, –∞ `updated_at` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.

#### 2. **–¶–µ–ª—å (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞)**  
–¢–∞–±–ª–∏—Ü–∞ `dim_client_scd2`:
```text
client_id | name | segment | valid_from | valid_to   | is_current
1         | –ò–≤–∞–Ω | Standard| 2025-01-01 | 2026-01-26 | false
1         | –ò–≤–∞–Ω | Premium | 2026-01-27 | 9999-12-31 | true
```

#### 3. **–ö–∞–∫ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π SCD2?**

##### –®–∞–≥ A: **–í—ã—è–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è**
- –ó–∞–ø–æ–º–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω—é—é –¥–∞—Ç—É –º–∏–≥—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ Airflow: `{{ ds }}` –∏–ª–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ `etl_log`).
- –í—ã–±–µ—Ä–∏ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Å—Ç—Ä–æ–∫–∏, –≥–¥–µ `updated_at > last_migration_time`.

##### –®–∞–≥ B: **–°—Ä–∞–≤–Ω–∏—Ç—å —Å —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–µ–π –≤ DWH**
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω—ë–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞:
  - –ï—Å–ª–∏ `segment` **–Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è** ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å.
  - –ï—Å–ª–∏ **–∏–∑–º–µ–Ω–∏–ª—Å—è** ‚Üí —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—å SCD2-–ª–æ–≥–∏–∫—É.

> üí° –≠—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≤ Python (pandas) –∏–ª–∏ SQL (JOIN –º–µ–∂–¥—É –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏ DWH).

##### –®–∞–≥ C: **–û–±–Ω–æ–≤–∏—Ç—å DWH**
- –ó–∞–∫—Ä—ã—Ç—å —Å—Ç–∞—Ä—É—é –∑–∞–ø–∏—Å—å (`valid_to = –≤—á–µ—Ä–∞`, `is_current = false`)
- –í—Å—Ç–∞–≤–∏—Ç—å –Ω–æ–≤—É—é (`valid_from = —Å–µ–≥–æ–¥–Ω—è`, `is_current = true`)

##### –®–∞–≥ D: **–ó–∞–ø–∏—Å–∞—Ç—å –≤ Parquet / Greenplum**
- –í Parquet: –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä—É–π –ø–æ `valid_from` –∏–ª–∏ `client_id`.
- –í Greenplum: –∏—Å–ø–æ–ª—å–∑—É–π distribution key –ø–æ `client_id`.

---

### üí° –ü—Ä–∏–º–µ—Ä –∏–∑ —Ç–≤–æ–µ–π –ø—Ä–∞–∫—Ç–∏–∫–∏ (–∫–∞–∫ —Å–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏):
> ¬´–ü—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ PostgreSQL –≤ Parquet —è —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞–ª –ª–æ–≥–∏–∫—É, –±–ª–∏–∑–∫—É—é –∫ SCD Type 2. –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤—ã–≥—Ä—É–∂–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ (–ø–æ `updated_at`). –í Python —è —Å—Ä–∞–≤–Ω–∏–≤–∞–ª –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–µ–π –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –ï—Å–ª–∏ —Å–µ–≥–º–µ–Ω—Ç –º–µ–Ω—è–ª—Å—è ‚Äî —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å —Å –¥–∞—Ç–æ–π –Ω–∞—á–∞–ª–∞ –¥–µ–π—Å—Ç–≤–∏—è, –∞ –ø—Ä–µ–¥—ã–¥—É—â–∞—è –ø–æ–º–µ—á–∞–ª–∞—Å—å –∫–∞–∫ –Ω–µ–∞–∫—Ç—É–∞–ª—å–Ω–∞—è. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–ª–æ —Å—Ç—Ä–æ–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –æ—Ç—á—ë—Ç—ã –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö¬ª.

üëâ –î–∞–∂–µ –µ—Å–ª–∏ —Ç—ã –Ω–µ –Ω–∞–∑–≤–∞–ª —ç—Ç–æ ¬´SCD Type 2¬ª —Ä–∞–Ω—å—à–µ ‚Äî **—Ç—ã —É–∂–µ –¥–µ–ª–∞–ª –µ–≥–æ —Å—É—Ç—å**.

---

 

---

–•–æ—á–µ—à—å ‚Äî –¥–∞–º —Ç–µ–±–µ **–º–∏–Ω–∏-–∑–∞–¥–∞—á—É**: –Ω–∞–ø–∏—à–∏ –ø—Å–µ–≤–¥–æ–∫–æ–¥ (–∏–ª–∏ SQL + Python) –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Ç–∞–∫–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏. –≠—Ç–æ –∑–∞–∫—Ä–µ–ø–∏—Ç –Ω–∞–≤—ã–∫.  
–ò–ª–∏ –ø–µ—Ä–µ–π–¥—ë–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –±–ª–æ–∫—É ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, Airflow + Cron?
